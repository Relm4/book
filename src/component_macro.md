# The component macro

To simplify the implementation of the `Component` trait, let's use the relm4-macros crate!

![App screenshot dark](img/screenshots/simple-dark.png)

The app will look and behave identically to our first app from the previous chapter. Only the implementation is different.

> The app we will write in this chapter is also available [here](https://github.com/AaronErhardt/relm4/blob/main/relm4-examples/examples/simple.rs). Run `cargo run --example simple` from the [example directory](https://github.com/AaronErhardt/relm4/tree/main/relm4-examples) if you want to see the code in action.

## The difference

The `component` macro will simplify creating the `Widgets` `struct`. The update code remains untouched, so we can reuse most of the code from the previous chapter.

Let's have a look at how to define a component with the macro and go through the code step by step:

```rust,no_run,noplayground
{{#include ../examples/simple.rs:macro }}
```

The associated types don't change. We still have to define the model, the input parameters, and the message types. However, the `Widgets` type `AppWidgets` is never explicitly defined in the code, but generated by the macro.

And then... wait, where do we define the `Root` type? Actually, the macro knows that your outermost widget becomes automatically the root widget.

Next up - the heart of the `component` macro - the nested `view!` macro. Here, we can easily define widgets and assign properties to them.

### Properties

As you see, we start with the `gtk::Window` which is our root. Then we open up brackets and assign properties to the window. There's not much magic here but actually [`set_title`](https://gtk-rs.org/gtk4-rs/git/docs/gtk4/prelude/trait.GtkWindowExt.html#tymethod.set_title) is a method provided by gtk4-rs. So technically, the macro creates code like this:

```rust,no_run,noplayground
window.set_title(Some("Simple app"));
```

### Widgets

We assign a child to the window by nesting another widget inside it. Widgets may be nested indefinitely:

```rust,no_run,noplayground
{{#include ../examples/simple.rs:widget_assign }}
```

Sometimes we want to use a constructor function to initialize our widgets. For the second button we used the `gtk::Button::with_label` function. This function returns a new button with the "Decrement" label already set, so we don't have to call `set_label` afterwards.

```rust,no_run,noplayground
{{#include ../examples/simple.rs:widget_assign_fn }}
```

### Events

To connect events, we use this syntax:

```rust,no_run,noplayground
method_name[cloned_var1, cloned_var2, ...] => move |args, ...| { code... }
```

Again, there's no magic. The macro will simply assign a closure to a method. Because closures often need to capture local variables that don't implement the `Copy` trait, we need to clone these variables. Therefore, we can list the variables we want to clone in the square brackets after the method name.

```rust,no_run,noplayground
{{#include ../examples/simple.rs:connect }}
```

> There's even a shorter syntax for just sending one input message that works with most event handlers.
> So instead of this:
> 
> ```rust,no_run,noplayground
> method_name[sender] => move |_| { sender.input(Msg); },
> ```
> 
> you can simply write this:
> 
> ```rust,no_run,noplayground
> method_name => Msg,
> ```

### UI updates

The last special syntax of the `component` macro we'll cover here is the `#[watch]` attribute. It's just like the normal initialization except that it also updates the property in the view function. Without it, the counter label would never be updated.

```rust,no_run,noplayground
{{#include ../examples/simple.rs:watch }}
```

> The full reference for the syntax of the widget macro can be found [here](https://aaronerhardt.github.io/relm4-book/book/widget_macro_reference.html).

## Constructing the Widgets

After we've defined our widgets, we need to construct them. This is done with the `view_output!` macro, which returns a fully-initialized instance of our `Widgets` struct.

```rust,no_run,noplayground
{{#include ../examples/simple.rs:view_output}}
```

## The complete code

Let's review our code in one piece one more time to see how all these parts work together:

```rust,no_run,noplayground
{{#include ../examples/simple.rs:all }}
```
